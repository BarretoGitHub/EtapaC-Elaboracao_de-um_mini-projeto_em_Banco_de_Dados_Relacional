-- Sistema para Loja de Aluguel e Venda de Produtos para Festas


-- *************************************  CRIANDO TABELAS   *************************************
CREATE TABLE CATEGORIA_CLIENTE(
	codigoCategoria INT NOT NULL PRIMARY KEY,
	descricao VARCHAR2(50),
	diasDeEmprestimo INT NOT NULL
);

CREATE SEQUENCE CATEGORIA_CLIENTE_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE; 
---------------------------------------

CREATE TABLE CATEGORIA_PRODUTO(
  idCategoriaProduto INT NOT NULL PRIMARY KEY,
  descricao VARCHAR2(50)
);

CREATE SEQUENCE CATEGORIA_PRODUTO_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE; 
---------------------------------------
CREATE TABLE CLIENTE(
  cpfCliente VARCHAR2(20) NOT NULL , 
  nomeCliente VARCHAR2(50) NOT NULL,
  enderecoCliente VARCHAR2(80) NOT NULL,
  cidadeCliente VARCHAR2(30) NOT NULL,
  estadoCliente VARCHAR2(20) NOT NULL,
  telefoneCliente VARCHAR2(15) NOT NULL,
  emailCliente VARCHAR2(50),
  codigoCategoria INT NOT NULL,
  CLIENTE_DATA_NASCIMENTO DATE,
  PRIMARY KEY(cpfCliente), 
  FOREIGN KEY (codigoCategoria) REFERENCES CATEGORIA_CLIENTE(codigoCategoria) ON DELETE SET NULL
);


CREATE SEQUENCE CLIENTE_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE;
-------------------------------------------------------------------
CREATE TABLE FORNECEDOR(
  CNPJ VARCHAR2(12) NOT NULL PRIMARY KEY,
  idProduto INT NOT NULL,
  nomeFornecedor VARCHAR2(80),
  enderecoFornecedor VARCHAR2(100),
  cidadeFornecedor VARCHAR2(100),
  estadoFornecedor VARCHAR2(80),
  emailFornecedor VARCHAR2(40),
  telefoneFornecedor VARCHAR2(15),
  FOREIGN KEY (idProduto) REFERENCES PRODUTO(idProduto) 
);

CREATE SEQUENCE FORNECEDOR_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE;
---------------------------------------------------------------------------------------------
CREATE TABLE PRODUTO(
  codigoDeBarras VARCHAR2(30),
  idProduto INT primary key,
  nomeProduto VARCHAR2(100),
  idCategoriaProduto INT NOT NULL,
  quantidadeEstoque INT NOT NULL,
  fabricante VARCHAR2(100),
  localizacaoPrateleira VARCHAR2(5),
  precoDiario NUMBER(8,2) NOT NULL,
  PROD_FORN_CNPJ VARCHAR2(15) NOT NULL,
  FOREIGN KEY (PROD_FORN_CNPJ) REFERENCES FORNECEDOR(CNPJ) ON DELETE SET NULL,
  FOREIGN KEY (idCategoriaProduto) REFERENCES CATEGORIA_PRODUTO(idCategoriaProduto) ON DELETE SET NULL
); 

CREATE SEQUENCE PRODUTO_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE;
---------------------------------------
CREATE TABLE PRODUTO_FORNECEDOR(
  ID_PRODUTO INT NOT NULL,
  CNPJ_FORNECEDOR VARCHAR2(15) NOT NULL,
  QTD_PRODUTO_COMPRAR INT NOT NULL,
  DATA_COMPRA TIMESTAMP NOT NULL,
  PRECO_UNITARIO NUMERIC(8,2) NOT NULL, 
  PRIMARY KEY(CNPJ_FORNECEDOR,ID_PRODUTO),
  FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(idProduto) ON DELETE CASCADE,
  FOREIGN KEY (CNPJ_FORNECEDOR) REFERENCES FORNECEDOR(CNPJ) ON DELETE CASCADE
);

CREATE SEQUENCE PRODUTO_FORNECEDOR_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE;
---------------------------------------
CREATE TABLE FUNCIONARIO(
  idFuncionario INT NOT NULL PRIMARY KEY,
  nomeFuncionario VARCHAR2(50),
  enderecoFuncionario VARCHAR2(50),
  telefoneFuncionario VARCHAR2(15),
  dataNascimentoFuncionario DATE
);

CREATE SEQUENCE FUNCIONARIO_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE;  
---------------------------------------
CREATE TABLE RESERVA(
  idReserva INT NOT NULL PRIMARY KEY,
  DATA_HORA TIMESTAMP,
  cpfCliente VARCHAR2(20) NOT NULL,
  idProduto INT NOT NULL,
  idFuncionario INT NOT NULL,
  RESERVAR_QTD_PRODUTO INT NOT NULL, 
  FOREIGN KEY (cpfCliente) REFERENCES CLIENTE(cpfCliente) ON DELETE CASCADE,
  FOREIGN KEY (idProduto) REFERENCES PRODUTO(idProduto) ON DELETE CASCADE,
  FOREIGN KEY (idFuncionario) REFERENCES FUNCIONARIO(idFuncionario) ON DELETE SET NULL
);

CREATE SEQUENCE RESERVA_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE;
---------------------------------------
CREATE TABLE EMPRESTIMO(
  idEmprestimo INT NOT NULL PRIMARY KEY,
  DATA_HORA_EMPRESTIMO DATE,
  dataPrevista DATE,
  cpfCliente VARCHAR2(20) NOT NULL,
  idFuncionario INT NOT NULL,
  EMPRESTIMO_ID_PRODUTO INT NOT NULL,  
  EMPRESTIMO_QTD_PRODUTO INT NOT NULL,
  EMP_VALOR NUMERIC(8,2) NOT NULL, 
  EMP_DESCONTO NUMERIC(4,2) NOT NULL, 
  FOREIGN KEY (cpfCliente) REFERENCES CLIENTE(cpfCliente) ON DELETE SET NULL,
  FOREIGN KEY (idFuncionario) REFERENCES FUNCIONARIO(idFuncionario) ON DELETE SET NULL,
  FOREIGN KEY (EMPRESTIMO_ID_PRODUTO) REFERENCES PRODUTO(idProduto) ON DELETE SET NULL
);

CREATE SEQUENCE EMPRESTIMO_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCYCLE;
---------------------------------------
CREATE TABLE DEVOLUCAO(
  DEVOLUCAO_ID INT PRIMARY KEY,
  DATA_HORA_DEVOLUCAO DATE,
  DEVOLUCAO_COD_BARRAS VARCHAR2(30),
  DEVOLUCAO_ID_FUNCIONARIO INT,
  DEVOLUCAO_CLIENTE_CPF VARCHAR2(20) NOT NULL,
  SUSPENSO CHAR(1),
  FOREIGN KEY (DEVOLUCAO_ID_FUNCIONARIO) REFERENCES FUNCIONARIO (idFuncionario) ON DELETE CASCADE,
  FOREIGN KEY (DEVOLUCAO_CLIENTE_CPF) REFERENCES CLIENTE(cpfCliente) ON DELETE CASCADE
);

CREATE SEQUENCE DEVOLUCAO_SEQUENCIA
INCREMENT BY 1
START WITH 1
MAXVALUE 99999
NOCACHE
NOCYCLE;


---------------------------------------------------------
-- ***********  POPULANDO TABELAS   ***********

-- POPULANDO TABELA CATEGORIA_CLIENTE --
INSERT INTO CATEGORIA_CLIENTE VALUES(CATEGORIA_CLIENTE_SEQUENCIA.NEXTVAL,'OURO',10);
INSERT INTO CATEGORIA_CLIENTE VALUES(CATEGORIA_CLIENTE_SEQUENCIA.NEXTVAL,'PRATA',5);
INSERT INTO CATEGORIA_CLIENTE VALUES(CATEGORIA_CLIENTE_SEQUENCIA.NEXTVAL,'BRONZE',3);
SELECT * FROM CATEGORIA_CLIENTE;


-- POPULANDO TABELA CATEGORIA_PRODUTO --
INSERT INTO CATEGORIA_PRODUTO VALUES(CATEGORIA_PRODUTO_SEQUENCIA.NEXTVAL,'Categoria A');
INSERT INTO CATEGORIA_PRODUTO VALUES(CATEGORIA_PRODUTO_SEQUENCIA.NEXTVAL,'Categoria B');
INSERT INTO CATEGORIA_PRODUTO VALUES(CATEGORIA_PRODUTO_SEQUENCIA.NEXTVAL,'Categoria C');
INSERT INTO CATEGORIA_PRODUTO VALUES(CATEGORIA_PRODUTO_SEQUENCIA.NEXTVAL,'Categoria D');
INSERT INTO CATEGORIA_PRODUTO VALUES(CATEGORIA_PRODUTO_SEQUENCIA.NEXTVAL,'Categoria E');
SELECT * FROM CATEGORIA_PRODUTO ;


-- POPULANDO TABELA CLIENTE --
INSERT INTO CLIENTE VALUES('592.001.154-89','Raul Thales Murilo Viana','Rua Joaquim Bruno da Mota','Mossoró','RN','(81)2558-2194','raulThales@gmail.com',1,'26/08/1995');
INSERT INTO CLIENTE VALUES('240.124.058-61','Alice Giovanna Nascimento','Pra?a da Matriz','Cajapiú','MA','(98)2589-3825','allicceGio@gmail.com',2,'1/08/2000');
INSERT INTO CLIENTE VALUES('603.496.378-81','Bárbara Olivia Helena da Luz"','Rua 29','Caucaia','CE','(85)3810-9453','oliviaBar@gmail.com',3,'16/07/1949');
INSERT INTO CLIENTE VALUES('327.152.155-76','Isaac Mateus Lopes"','Travessa Quinze','Aracaju','SE','(79)2544-5003','lopes123@gmail.com',1,'22/02/1957');
INSERT INTO CLIENTE VALUES('486.200.451-21','Simone Eduarda Caldeira"','Avenida Dom Hélder Câmara','Araraquara','SP','(16) 3938-4009','caldeira97@gmail.com',3,'26/08/1997');
INSERT INTO CLIENTE VALUES('429.349.672-63','Victor Hugo da Cost"','Rua Julio de Aquino','São Carlos','SP','(16) 98441-9666','hugoCost5@gmail.com',2,'5/07/2006');
SELECT * FROM CLIENTE ;


-- POPULANDO TABELA FONECEDOR --
INSERT INTO FORNECEDOR VALUES('90.897.5-9',1,'Brasil 2000','Rua Itália','Araraquara','SP','fornItalia@hotmail.com','(16)3445-8776');
INSERT INTO FORNECEDOR VALUES('56.453.9-2',2,'Nigro ','Avenida Espanha','Araraquara','SP','nigro@hotmail.com','(16)3996-0070');
INSERT INTO FORNECEDOR VALUES('12.438.4-6',3,'Casas A-Z','Rua Nove de Agosto','Araraquara','SP','casaAZ@hotmail.com','(16)3445-8776');
INSERT INTO FORNECEDOR VALUES('16.666.6-6',5,'SONY','Rua Ipiranga','São Paulo','SP','sony19@hotmail.com','(11)3333-9779');
INSERT INTO FORNECEDOR VALUES('17.777.7-9',4,'Brass15','Rual Luiz Alberto','Matão','SP','brass15@gmail.com','(16)8686-4449');
SELECT * FROM FORNECEDOR;


-- POPULANDO TABELA PRODUTO --
INSERT INTO PRODUTO VALUES('EWWQe4rc1T',PRODUTO_SEQUENCIA.NEXTVAL,'MESAS',1,120,'Fab X','P1',120.5,'90.897.5-9');
INSERT INTO PRODUTO VALUES('6Ar8L6bMhQ',PRODUTO_SEQUENCIA.NEXTVAL,'CADEIRAS',2,780,'Fab Y','P2',89.9,'12.438.4-6');
INSERT INTO PRODUTO VALUES('RkClACMSxE',PRODUTO_SEQUENCIA.NEXTVAL,'COPOS',3,344,'Fab Z','P3',17.6,'17.777.7-9');
INSERT INTO PRODUTO VALUES('6wWp544Deb',PRODUTO_SEQUENCIA.NEXTVAL,'TALHERES',4,1200,'Fab KJ','P3',9.9,'56.453.9-2');
INSERT INTO PRODUTO VALUES('pxEQFJQirZ',PRODUTO_SEQUENCIA.NEXTVAL,'SOM/ÁUDIO',5,10,'Fab SP','P4',350.9,'16.666.6-6');
SELECT * FROM PRODUTO;


-- POPULANDO TABELA PRODUTO_FORNECEDOR --
INSERT INTO PRODUTO_FORNECEDOR VALUES(1,'90.897.5-9',120,SYSDATE,120.00);
INSERT INTO PRODUTO_FORNECEDOR VALUES(2,'12.438.4-6',780,SYSDATE,100.00);
INSERT INTO PRODUTO_FORNECEDOR VALUES(3,'17.777.7-9',344,SYSDATE,60.20);
INSERT INTO PRODUTO_FORNECEDOR VALUES(4,'56.453.9-2',1200,SYSDATE,7.8);
INSERT INTO PRODUTO_FORNECEDOR VALUES(5,'16.666.6-6',10,SYSDATE,230.00);
SELECT * FROM PRODUTO_FORNECEDOR;


-- POPULANDO TABELA FUNCIONARIO --
INSERT INTO FUNCIONARIO VALUES(FUNCIONARIO_SEQUENCIA.NEXTVAL,'João Victor dos Santos','Avenida América','(16)3333-3333','12/1/1999');
INSERT INTO FUNCIONARIO VALUES(FUNCIONARIO_SEQUENCIA.NEXTVAL,'Wesley Gabriel Barreto','Avenida Brasil','(16)3331-2433','26/8/2000');
INSERT INTO FUNCIONARIO VALUES(FUNCIONARIO_SEQUENCIA.NEXTVAL,'Alissa Fernandes','Rua Padre Duarte','(16)3736-2963','9/9/2002');
INSERT INTO FUNCIONARIO VALUES(FUNCIONARIO_SEQUENCIA.NEXTVAL,'Maria Bastos','Rua Carlos Gomes','(16)3939-9965','9/7/2007');
SELECT * FROM FUNCIONARIO;


-- POPULANDO TABELA RESERVA -- 
INSERT INTO RESERVA VALUES(RESERVA_SEQUENCIA.NEXTVAL, SYSDATE,'592.001.154-89',1,1,2);
INSERT INTO RESERVA VALUES(RESERVA_SEQUENCIA.NEXTVAL, SYSDATE,'240.124.058-61',2,2,5);
INSERT INTO RESERVA VALUES(RESERVA_SEQUENCIA.NEXTVAL, SYSDATE,'603.496.378-81',3,3,8);
INSERT INTO RESERVA VALUES(RESERVA_SEQUENCIA.NEXTVAL, SYSDATE,'327.152.155-76',4,4,7);
INSERT INTO RESERVA VALUES(RESERVA_SEQUENCIA.NEXTVAL, SYSDATE,'486.200.451-21',1,2,2);
SELECT * FROM RESERVA;


-- POPULANDO TABELA EMPRESTIMO -- 
INSERT INTO EMPRESTIMO VALUES(EMPRESTIMO_SEQUENCIA.NEXTVAL, '04/12/19', SYSDATE + 7,'592.001.154-89',1,1 ,2,241.00,0);
INSERT INTO EMPRESTIMO VALUES(EMPRESTIMO_SEQUENCIA.NEXTVAL, '05/12/19', SYSDATE + 7 ,'240.124.058-61',2,2,3,269.70,0);
INSERT INTO EMPRESTIMO VALUES(EMPRESTIMO_SEQUENCIA.NEXTVAL, '06/12/19', SYSDATE + 7 ,'603.496.378-81',3,3,1,17.60,0);
INSERT INTO EMPRESTIMO VALUES(EMPRESTIMO_SEQUENCIA.NEXTVAL, '07/12/19', SYSDATE + 7 ,'327.152.155-76',4,4,2,19.80,0);
INSERT INTO EMPRESTIMO VALUES(EMPRESTIMO_SEQUENCIA.NEXTVAL, '08/12/19', SYSDATE + 7 ,'486.200.451-21',2,5,1,350.00,0);
SELECT * FROM EMPRESTIMO;


-- POPULANDO TABELA DEVOLUCAO -- 
INSERT INTO DEVOLUCAO VALUES(DEVOLUCAO_SEQUENCIA.NEXTVAL,SYSDATE,'592.001.154-89',1,'592.001.154-89','S');
INSERT INTO DEVOLUCAO VALUES(DEVOLUCAO_SEQUENCIA.NEXTVAL,SYSDATE,'240.124.058-61',1,'240.124.058-61','S');
INSERT INTO DEVOLUCAO VALUES(DEVOLUCAO_SEQUENCIA.NEXTVAL,SYSDATE,'603.496.378-81',1,'603.496.378-81','S');
INSERT INTO DEVOLUCAO VALUES(DEVOLUCAO_SEQUENCIA.NEXTVAL,SYSDATE,'327.152.155-76',1,'327.152.155-76','N');
INSERT INTO DEVOLUCAO VALUES(DEVOLUCAO_SEQUENCIA.NEXTVAL,SYSDATE,'486.200.451-21',1,'486.200.451-21','N');
SELECT * FROM DEVOLUCAO ;



-- *********** SELECTS TABLES ***********
SELECT * FROM CLIENTE;
SELECT * FROM FORNECEDOR;
SELECT * FROM FUNCIONARIO;
SELECT * FROM PRODUTO;
SELECT * FROM PRODUTO_FORNECEDOR;
SELECT * FROM CATEGORIA_PRODUTO;
SELECT * FROM CATEGORIA_CLIENTE;
SELECT * FROM RESERVA;
SELECT * FROM EMPRESTIMO;
SELECT * FROM DEVOLUCAO;

-- *********** DROPS TABLES ***********
DROP TABLE CLIENTE;
DROP TABLE FORNECEDOR;
DROP TABLE FUNCIONARIO;
DROP TABLE PRODUTO;
DROP TABLE PRODUTO_FORNECEDOR;
DROP TABLE CATEGORIA_PRODUTO;
DROP TABLE CATEGORIA_CLIENTE;
DROP TABLE RESERVA;
DROP TABLE EMPRESTIMO;
DROP TABLE DEVOLUCAO;

--*********** DROPS SEQUENCES ***********
DROP SEQUENCE CLIENTE_SEQUENCIA;
DROP SEQUENCE FORNECEDOR_SEQUENCIA;
DROP SEQUENCE FUNCIONARIO_SEQUENCIA;
DROP SEQUENCE PRODUTO_SEQUENCIA;
DROP SEQUENCE PRODUTO_FORNECEDOR_SEQUENCIA;
DROP SEQUENCE CATEGORIA_PRODUTO_SEQUENCIA;
DROP SEQUENCE CATEGORIA_CLIENTE_SEQUENCIA;
DROP SEQUENCE EMPRESTIMO_SEQUENCIA;
DROP SEQUENCE DEVOLUCAO_SEQUENCIA;
DROP SEQUENCE RESERVA_SEQUENCIA;

--*********** DELETES ***********
DELETE FROM CATEGORIA_CLIENTE WHERE 1=1;
DELETE FROM CATEGORIA_PRODUTO WHERE 1=1;
DELETE FROM CLIENTE WHERE 1=1;
DELETE FROM FORNECEDOR WHERE 1=1;
DELETE FROM PRODUTO_FORNECEDOR WHERE 1=1;
DELETE FROM PRODUTO WHERE 1=1;
DELETE FROM FUNCIONARIO WHERE 1=1;
DELETE FROM RESERVA WHERE 1=1;
DELETE FROM EMPRESTIMO WHERE 1=1;
DELETE FROM DEVOLUCAO WHERE 1=1;

